{% extends 'base.html' %}

{% block title %}Configurar Tokenização{% endblock %}

{% block content %}
<div class="container">
    <h1>Configurar Tokenização</h1>
    <form id="tokenizationForm" method="post" action="/api/tokenization/configure/">
        {% csrf_token %}
        <div class="form-group">
            <label for="valuation">Valor da Empresa (KZ):</label>
            <input type="number" class="form-control" name="valuation" id="valuation" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="percentage">Percentual a Tokenizar (%):</label>
            <input type="number" class="form-control" name="percentage" id="percentage" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="token_quantity">Quantidade de Tokens:</label>
            <input type="number" class="form-control" name="token_quantity" id="token_quantity" required>
        </div>
        <div class="form-group">
            <label for="token_price">Preço por Token (KZ):</label>
            <input type="number" class="form-control" name="token_price" id="token_price" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="token_name">Nome do Token:</label>
            <input type="text" class="form-control" name="token_name" id="token_name" required>
        </div>
        <div class="form-group">
            <label for="token_symbol">Símbolo do Token:</label>
            <input type="text" class="form-control" name="token_symbol" id="token_symbol" required>
        </div>
        <div class="form-group">
            <label for="description">Descrição:</label>
            <textarea class="form-control" name="description" id="description" rows="3"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Enviar Pedido de Tokenização</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Função para obter o valor de um cookie (necessário para CSRF)
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + "=")) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    document.getElementById("tokenizationForm").addEventListener("submit", async function(e) {
        e.preventDefault();
        const formData = {
            valuation: document.getElementById("valuation").value,
            percentage: document.getElementById("percentage").value,
            token_quantity: document.getElementById("token_quantity").value,
            token_price: document.getElementById("token_price").value,
            token_name: document.getElementById("token_name").value,
            token_symbol: document.getElementById("token_symbol").value,
            description: document.getElementById("description").value
        };

        try {
            const response = await fetch("/api/tokenization/configure/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": csrftoken
                },
                credentials: "include",
                body: JSON.stringify(formData)
            });
            const result = await response.json();
            if (response.ok) {
                alert(result.message);
                // Aqui você pode redirecionar para outra página se desejar
            } else {
                alert("Erro: " + JSON.stringify(result));
            }
        } catch (error) {
            console.error("Erro ao enviar pedido de tokenização:", error);
            alert("Erro de conexão: " + error);
        }
    });
</script>
{% endblock %}
